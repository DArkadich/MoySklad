# ü§ñ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–∫—É–ø–æ–∫ —Å ML-–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ–º

–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–∫—É–ø–æ–∫ –≤ –ú–æ–π–°–∫–ª–∞–¥ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø—Ä–æ—Å–∞.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **ML-–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–æ—Å–∞** –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤** —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏
- **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º** –ø—Ä–∏ –Ω–∏–∑–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–∞—Ö
- **REST API** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
- **–î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** –∏ –æ—Ç—á–µ—Ç—ã
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ú–æ–π–°–∫–ª–∞–¥ API  ‚îÇ    ‚îÇ  ML Forecast    ‚îÇ    ‚îÇ  Daily Auto-    ‚îÇ
‚îÇ                 ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ  API (8001)     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ  mation (6:00)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   PostgreSQL    ‚îÇ    ‚îÇ     Redis       ‚îÇ    ‚îÇ    RabbitMQ     ‚îÇ
‚îÇ   (5432)        ‚îÇ    ‚îÇ    (6379)       ‚îÇ    ‚îÇ   (5672/15672)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- –¢–æ–∫–µ–Ω API –ú–æ–π–°–∫–ª–∞–¥
- Python 3.8+

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ:

```bash
# –¢–æ–∫–µ–Ω API –ú–æ–π–°–∫–ª–∞–¥
MOYSKLAD_API_TOKEN=your_moysklad_api_token_here

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
POSTGRES_DB=moysklad
POSTGRES_USER=moysklad
POSTGRES_PASSWORD=moysklad123

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Redis
REDIS_URL=redis://redis:6379

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ RabbitMQ
RABBITMQ_URL=amqp://moysklad:moysklad123@rabbitmq:5672/
```

### 3. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

```bash
# –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x start_system.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É
./start_system.sh
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl http://localhost:8001/health

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs forecast-api
```

## üìã API Endpoints

### –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–æ—Å–∞

```bash
# POST /forecast
curl -X POST "http://localhost:8001/forecast" \
  -H "Content-Type: application/json" \
  -d '{
    "product_code": "60800",
    "forecast_days": 30
  }'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "product_code": "60800",
  "current_stock": 15.5,
  "forecast_consumption": 0.0295,
  "days_until_oos": 525,
  "recommended_order": 0,
  "confidence": 0.8,
  "models_used": ["linear_regression", "random_forest"]
}
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

```bash
# POST /auto-purchase
curl -X POST "http://localhost:8001/auto-purchase" \
  -H "Content-Type: application/json" \
  -d '{
    "product_code": "60800",
    "forecast_days": 30
  }'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã

```bash
# GET /health
curl http://localhost:8001/health
```

## üîÑ –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 6:00 –∏:

1. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Å—Ç–∞—Ç–∫–∏** –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ú–æ–π–°–∫–ª–∞–¥
2. **–î–µ–ª–∞–µ—Ç ML-–ø—Ä–æ–≥–Ω–æ–∑** –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
3. **–°–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑—ã** –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ —Å –Ω–∏–∑–∫–∏–º–∏ –æ—Å—Ç–∞—Ç–∫–∞–º–∏
4. **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç—á–µ—Ç—ã** –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

### –û—Ç—á–µ—Ç—ã

- **–î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç:** `/app/data/daily_report_YYYYMMDD.json`
- **–°–≤–æ–¥–∫–∞:** `/app/data/daily_summary.json`
- **–õ–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:** `/app/data/automation.log`

## üìä ML-–º–æ–¥–µ–ª–∏

### –û–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏:
- **–õ–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è** (R¬≤: 1.0000)
- **–°–ª—É—á–∞–π–Ω—ã–π –ª–µ—Å** (R¬≤: 0.9948)

### –ü—Ä–∏–∑–Ω–∞–∫–∏ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è:
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ: –≥–æ–¥, –∫–≤–∞—Ä—Ç–∞–ª, –º–µ—Å—è—Ü
- –ü—Ä–æ–¥–∞–∂–∏: –æ–±—â–∏–µ –ø—Ä–æ–¥–∞–∂–∏, –ø—Ä–æ–¥–∞–∂–∏ –≤ –¥–µ–Ω—å, –¥–Ω–∏ —Å –ø—Ä–æ–¥–∞–∂–∞–º–∏
- –û—Å—Ç–∞—Ç–∫–∏: –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ, —Å—Ä–µ–¥–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–∏
- –ß–∞—Å—Ç–æ—Ç–∞: —á–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–¥–∞–∂, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ—Å—Ç–∞—Ç–∫–æ–≤

## üõ† –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
services/moysklad-service/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api_forecast.py          # FastAPI –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ daily_automation.py      # –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ train_forecast_models.py # –û–±—É—á–µ–Ω–∏–µ ML-–º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ export_demands.py        # –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ú–æ–π–°–∫–ª–∞–¥
‚îÇ   ‚îî‚îÄ‚îÄ core/
‚îÇ       ‚îî‚îÄ‚îÄ config.py            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ data/                        # –î–∞–Ω–Ω—ã–µ –∏ –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ Dockerfile                   # Docker –æ–±—Ä–∞–∑
‚îî‚îÄ‚îÄ requirements.txt             # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

### –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

```bash
# –û–±—É—á–µ–Ω–∏–µ ML-–º–æ–¥–µ–ª–µ–π
docker-compose run --rm -w /app moysklad-service python app/train_forecast_models.py
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
docker-compose run --rm -w /app moysklad-service python -m pytest tests/
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

```bash
# –õ–æ–≥–∏ API
docker-compose logs forecast-api

# –õ–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
docker-compose logs automation-cron

# –õ–æ–≥–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose logs postgres
```

### –ú–µ—Ç—Ä–∏–∫–∏

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- –¢–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ cron –≤ `docker-compose.yml`:

```yaml
command: |
  sh -c "
    echo '0 6 * * * python /app/app/daily_automation.py >> /app/data/automation.log 2>&1' > /etc/crontabs/root &&
    crond -f -d 8
  "
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```bash
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ API
docker-compose restart forecast-api

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs forecast-api
```

### –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ú–æ–π–°–∫–ª–∞–¥

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ URL API
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã API

### –ü—Ä–æ–±–ª–µ–º—ã —Å ML-–º–æ–¥–µ–ª—è–º–∏

```bash
# –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
docker-compose run --rm -w /app moysklad-service python app/train_forecast_models.py
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs`
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ `.env`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API –ú–æ–π–°–∫–ª–∞–¥
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ú–æ–π–°–∫–ª–∞–¥ API

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
