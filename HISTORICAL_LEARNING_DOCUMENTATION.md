# üìö –°–∏—Å—Ç–µ–º–∞ –û–±—É—á–µ–Ω–∏—è –Ω–∞ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –î–∞–Ω–Ω—ã—Ö

## üéØ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –±—ã–ª–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –¥–ª—è **–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è** –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∑–∞ 4 –≥–æ–¥–∞ —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º **–¥–æ–æ–±—É—á–µ–Ω–∏–µ–º** —Å–≤–µ–∂–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

## üîÑ –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±—É—á–µ–Ω–∏—è

### **–≠—Ç–∞–ø 1: –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ (–æ–¥–∏–Ω —Ä–∞–∑)**
```bash
# –ó–∞–ø—É—Å–∫ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
python3 train_initial_models.py
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–∞–ø–∫–∏ `/app/data/`
2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ 4 –≥–æ–¥–∞ (–æ—Å—Ç–∞—Ç–∫–∏ + –ø—Ä–æ–¥–∞–∂–∏)
3. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Å —É—á–µ—Ç–æ–º —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥–æ–≤
4. –û–±—É—á–µ–Ω–∏–µ RandomForest –º–æ–¥–µ–ª–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –≤ `/app/data/models/`

### **–≠—Ç–∞–ø 2: –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –¥–æ–æ–±—É—á–µ–Ω–∏–µ**
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ 6:00
python3 daily_automation.py
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π
2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
3. –î–æ–æ–±—É—á–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ –∫–∞—á–µ—Å—Ç–≤–∞

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (–ø–∞–ø–∫–∞ `/app/data/`):**
```
/app/data/
‚îú‚îÄ‚îÄ stock_history.csv      # –ò—Å—Ç–æ—Ä–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ –∑–∞ 4 –≥–æ–¥–∞
‚îú‚îÄ‚îÄ sales_history.csv      # –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂ –∑–∞ 4 –≥–æ–¥–∞
‚îú‚îÄ‚îÄ production_data.csv    # –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îî‚îÄ‚îÄ ...
```

### **–û–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–ø–∞–ø–∫–∞ `/app/data/models/`):**
```
/app/data/models/
‚îú‚îÄ‚îÄ 12345.joblib          # –ú–æ–¥–µ–ª—å –¥–ª—è —Ç–æ–≤–∞—Ä–∞ 12345
‚îú‚îÄ‚îÄ 67890.joblib          # –ú–æ–¥–µ–ª—å –¥–ª—è —Ç–æ–≤–∞—Ä–∞ 67890
‚îú‚îÄ‚îÄ historical_training_results.json
‚îú‚îÄ‚îÄ incremental_training_results.json
‚îî‚îÄ‚îÄ ...
```

## üèóÔ∏è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### **1. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ** (`train_historical_models.py`)

```python
class HistoricalModelTrainer:
    # –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ CSV —Ñ–∞–π–ª–æ–≤
    def load_historical_data()
    
    # –°–æ–∑–¥–∞–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏–∑ 4-–ª–µ—Ç–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    def prepare_historical_features()
    
    # –û–±—É—á–∞–µ—Ç –º–æ–¥–µ–ª–∏ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    def train_model_for_product()
    
    # –û–±—É—á–∞–µ—Ç –≤—Å–µ –º–æ–¥–µ–ª–∏
    def train_models_on_historical_data()
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ 4 –≥–æ–¥–∞
- –°–æ–∑–¥–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–ª–∞–≥–∏, —Ç—Ä–µ–Ω–¥—ã, —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å)
- RandomForest —Å 200 –¥–µ—Ä–µ–≤—å—è–º–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
- –ú–∏–Ω–∏–º—É–º 30 –¥–Ω–µ–π –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è

### **2. –î–æ–æ–±—É—á–µ–Ω–∏–µ** (`incremental_learning.py`)

```python
class IncrementalModelTrainer:
    # –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –º–æ–¥–µ–ª—å
    def load_existing_model()
    
    # –ü–æ–ª—É—á–∞–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
    def get_fresh_data()
    
    # –î–æ–æ–±—É—á–∞–µ—Ç –º–æ–¥–µ–ª—å —Å–≤–µ–∂–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    def incremental_train_model()
    
    # –î–æ–æ–±—É—á–∞–µ—Ç –≤—Å–µ –º–æ–¥–µ–ª–∏
    def incremental_train_all_models()
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏
- –ü–æ–ª—É—á–∞–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ 30 –¥–Ω–µ–π
- –î–æ–æ–±—É—á–∞–µ—Ç –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –æ–±—É—á–µ–Ω–∏—è

### **3. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** (`daily_automation.py`)

```python
async def update_ml_models():
    # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –º–æ–¥–µ–ª–µ–π
    existing_models = [f for f in os.listdir(models_dir) if f.endswith('.joblib')]
    
    if existing_models:
        # –î–æ–æ–±—É—á–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π
        trainer = IncrementalModelTrainer()
        await trainer.incremental_train_all_models()
    else:
        # –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ
        trainer = HistoricalModelTrainer()
        await trainer.train_models_on_historical_data()
```

## üîÑ Workflow —Å–∏—Å—Ç–µ–º—ã

### **–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫:**
1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö** - –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ CSV —Ñ–∞–π–ª—ã –≤ `/app/data/`
2. **–û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π** - `python3 train_initial_models.py`
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞** - –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ JSON —Ñ–∞–π–ª–∞—Ö
4. **–ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã** - `./start_system_optimized.sh`

### **–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞:**
1. **6:00** - –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–µ–π** - –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤ `.joblib`
3. **–î–æ–æ–±—É—á–µ–Ω–∏–µ** - —Å–≤–µ–∂–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∑–∞ 30 –¥–Ω–µ–π
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - –º–æ–¥–µ–ª–µ–π –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
5. **–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ **–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π**
- –û–±—É—á–µ–Ω–∏–µ –Ω–∞ 4-–ª–µ—Ç–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –£—á–µ—Ç —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ –∏ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã—Ö —Ç—Ä–µ–Ω–¥–æ–≤
- –°–ª–æ–∂–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–ª–∞–≥–∏, —Å–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ, —Ç—Ä–µ–Ω–¥—ã)

### ‚úÖ **–ë—ã—Å—Ç—Ä–∞—è —Ä–∞–±–æ—Ç–∞**
- –ú–æ–¥–µ–ª–∏ —É–∂–µ –æ–±—É—á–µ–Ω—ã
- –¢–æ–ª—å–∫–æ –¥–æ–æ–±—É—á–µ–Ω–∏–µ —Å–≤–µ–∂–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –ë—ã—Å—Ç—Ä–æ–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–æ–±—É—á–µ–Ω–∏–µ
- –£—á–µ—Ç –Ω–æ–≤—ã—Ö —Ç—Ä–µ–Ω–¥–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–µ–π

### ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤**
- –û–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¥–æ–æ–±—É—á–µ–Ω–∏–µ
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### **–ü—Ä–∏–∑–Ω–∞–∫–∏ –¥–ª—è ML:**
```python
# –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
'year', 'month', 'day', 'day_of_year', 'day_of_week'
'is_month_start', 'is_quarter_start', 'is_weekend'

# –°–µ–∑–æ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
'is_holiday_season', 'is_summer_season', 'is_spring_season', 'is_autumn_season'

# –õ–∞–≥–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
'stock_lag_1', 'sales_lag_1', 'stock_lag_7', 'sales_lag_7', 'stock_lag_30', 'sales_lag_30'

# –°–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ
'sales_ma_7', 'stock_ma_7', 'sales_ma_30', 'stock_ma_30'

# –¢—Ä–µ–Ω–¥—ã
'sales_trend_7', 'stock_trend_7'
```

### **–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:**
- **MAE** (Mean Absolute Error) - —Å—Ä–µ–¥–Ω—è—è –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –æ—à–∏–±–∫–∞
- **R¬≤** (R-squared) - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∞—Ü–∏–∏
- **Model Score** - –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π R¬≤ [0,1]

### **–§–æ—Ä–º–∞—Ç –º–æ–¥–µ–ª–µ–π:**
```python
model_data = {
    'model': RandomForestRegressor,
    'scaler': StandardScaler,
    'metadata': {
        'product_code': '12345',
        'trained_at': '2024-01-01T00:00:00',
        'training_samples': 1000,
        'mae': 2.5,
        'r2_score': 0.85,
        'model_score': 0.85,
        'data_period': {
            'start_date': '2020-01-01',
            'end_date': '2024-01-01',
            'total_days': 1460
        },
        'model_type': 'historical_trained'
    }
}
```

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É

### **1. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ:**
```bash
# –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
python3 train_initial_models.py
```

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—É—á–µ–Ω–∏—è
cat /app/data/models/historical_training_results.json
```

### **3. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã:**
```bash
# –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã —Å –æ–±—É—á–µ–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏
./start_system_optimized.sh
```

### **4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ML API
python3 test_api_ml.py
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### **–§–∞–π–ª—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
- `historical_training_results.json` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
- `incremental_training_results.json` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–æ–æ–±—É—á–µ–Ω–∏—è
- `daily_report_YYYYMMDD.json` - –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

### **–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:**
- –°—Ä–µ–¥–Ω–∏–π MAE –ø–æ –≤—Å–µ–º –º–æ–¥–µ–ª—è–º
- –°—Ä–µ–¥–Ω–∏–π R¬≤ –ø–æ –≤—Å–µ–º –º–æ–¥–µ–ª—è–º
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- –í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è/–¥–æ–æ–±—É—á–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏! üöÄ 