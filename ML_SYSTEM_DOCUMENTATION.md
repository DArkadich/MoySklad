# ü§ñ ML –°–∏—Å—Ç–µ–º–∞ –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –±—ã–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è **—Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –∏ **ML –º–æ–¥–µ–ª–µ–π** –≤–º–µ—Å—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

## üîÑ –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### ‚úÖ **–ò—Å–∫–ª—é—á–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**
- –£–¥–∞–ª–µ–Ω `api_simple.py` —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- –°–æ–∑–¥–∞–Ω `api_ml.py` —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ ML –º–æ–¥–µ–ª—è–º–∏
- –í—Å–µ –ø—Ä–æ–≥–Ω–æ–∑—ã –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ú–æ–π–°–∫–ª–∞–¥

### ‚úÖ **–ü–æ–¥–∫–ª—é—á–µ–Ω—ã ML –º–æ–¥–µ–ª–∏**
- **RandomForest** –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è
- **StandardScaler** –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- **Joblib** –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ** –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ

### ‚úÖ **–†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**
- **–ò—Å—Ç–æ—Ä–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤** –∏–∑ –ú–æ–π–°–∫–ª–∞–¥ API
- **–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂** –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–æ–¥–∞–∂
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏** (—Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å, –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏)
- **–õ–∞–≥–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏** (–æ—Å—Ç–∞—Ç–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –ø—Ä–æ—à–ª—ã–µ –ø–µ—Ä–∏–æ–¥—ã)

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ML —Å–∏—Å—Ç–µ–º—ã

### 1. **–û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π** (`train_ml_models.py`)

```python
# –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- MLModelTrainer - –∫–ª–∞—Å—Å –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
- get_real_stock_history() - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤
- get_real_sales_history() - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ–¥–∞–∂
- create_ml_features() - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- train_model_for_product() - –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è —Ç–æ–≤–∞—Ä–∞
```

**–ü—Ä–∏–∑–Ω–∞–∫–∏ –¥–ª—è ML:**
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ: –≥–æ–¥, –º–µ—Å—è—Ü, –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏, —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å
- –¢–æ–≤–∞—Ä–Ω—ã–µ: –∫–æ–¥ —Ç–æ–≤–∞—Ä–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –≥—Ä—É–ø–ø–∞
- –û—Å—Ç–∞—Ç–∫–∏: —Ç–µ–∫—É—â–∏–µ –æ—Å—Ç–∞—Ç–∫–∏, –ª–∞–≥–∏, —Å–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ
- –ü—Ä–æ–¥–∞–∂–∏: –¥–Ω–µ–≤–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏, –ª–∞–≥–∏, —Ç—Ä–µ–Ω–¥—ã

### 2. **API –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è** (`api_ml.py`)

```python
# –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:
- GET /health - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- GET /models/status - —Å—Ç–∞—Ç—É—Å –º–æ–¥–µ–ª–µ–π
- POST /forecast - –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–æ—Å–∞
- GET / - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
```

**–õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏–∑ –ú–æ–π–°–∫–ª–∞–¥
2. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è ML –º–æ–¥–µ–ª–∏
3. –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é RandomForest
4. –†–∞—Å—á–µ—Ç –¥–Ω–µ–π –¥–æ OoS –∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–≥–æ –∑–∞–∫–∞–∑–∞
5. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

### 3. **–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** (`daily_automation.py`)

```python
# –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞:
- update_ml_models() - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ML –º–æ–¥–µ–ª–µ–π
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
```

## üîÑ Workflow –æ–±—É—á–µ–Ω–∏—è

### **–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:**

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** (90 –¥–Ω–µ–π –Ω–∞–∑–∞–¥)
   - –ò—Å—Ç–æ—Ä–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø–æ –¥–Ω—è–º
   - –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º
   - –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ —Ç–æ–≤–∞—Ä–∞–º

2. **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤**
   - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (—Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å, –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏)
   - –õ–∞–≥–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–æ—Å—Ç–∞—Ç–∫–∏/–ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –ø—Ä–æ—à–ª—ã–µ –ø–µ—Ä–∏–æ–¥—ã)
   - –°–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ (7 –¥–Ω–µ–π)

3. **–û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏**
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ train/test (80/20)
   - –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (StandardScaler)
   - –û–±—É—á–µ–Ω–∏–µ RandomForest (100 –¥–µ—Ä–µ–≤—å–µ–≤)
   - –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (MAE, R¬≤)

4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏**
   - –ú–æ–¥–µ–ª—å + scaler + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
   - –§–æ—Ä–º–∞—Ç: `{product_code}.joblib`
   - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: `/app/data/models/`

## üìä –ö–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π

### **–ú–µ—Ç—Ä–∏–∫–∏ –æ—Ü–µ–Ω–∫–∏:**
- **MAE** (Mean Absolute Error) - —Å—Ä–µ–¥–Ω—è—è –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –æ—à–∏–±–∫–∞
- **R¬≤** (R-squared) - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∞—Ü–∏–∏
- **Model Score** - –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π R¬≤ [0,1]

### **Fallback –ª–æ–≥–∏–∫–∞:**
- –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Üí –±–∞–∑–æ–≤—ã–π –ø—Ä–æ–≥–Ω–æ–∑ (5 –µ–¥/–¥–µ–Ω—å)
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –æ–±—É—á–µ–Ω–∏—è ‚Üí fallback —Å –Ω–∏–∑–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é
- –ï—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

## üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

### **1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
```bash
# docker-compose.yml —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç api_ml.py
command: python app/api_ml.py
```

### **2. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã:**
```bash
./start_system_optimized.sh
```

### **3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ML API:**
```bash
python3 test_api_ml.py
```

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ **–†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**
- –ü—Ä–æ–≥–Ω–æ–∑—ã –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂–∞—Ö
- –£—á–µ—Ç —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥–æ–≤
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º —Å–ø—Ä–æ—Å–∞

### ‚úÖ **ML –º–æ–¥–µ–ª–∏**
- RandomForest –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

### ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**
- –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤

### ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**
- –û—Ç–¥–µ–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```python
scikit-learn==1.3.0  # ML –∞–ª–≥–æ—Ä–∏—Ç–º—ã
joblib==1.3.2        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
pandas==2.0.3        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
numpy==1.24.3        # –ß–∏—Å–ª–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
```

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
```
/app/data/models/
‚îú‚îÄ‚îÄ 12345.joblib          # –ú–æ–¥–µ–ª—å –¥–ª—è —Ç–æ–≤–∞—Ä–∞ 12345
‚îú‚îÄ‚îÄ 67890.joblib          # –ú–æ–¥–µ–ª—å –¥–ª—è —Ç–æ–≤–∞—Ä–∞ 67890
‚îú‚îÄ‚îÄ training_results.json  # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è
‚îî‚îÄ‚îÄ ...
```

### **API –æ—Ç–≤–µ—Ç—ã:**
```json
{
  "product_code": "12345",
  "current_stock": 150.0,
  "forecast_consumption": 8.5,
  "days_until_oos": 17,
  "recommended_order": 105.0,
  "final_order": 100,
  "confidence": 0.85,
  "model_type": "ml_enhanced",
  "models_used": ["ml_enhanced"]
}
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### **–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
- –ü—Ä–æ—Å—Ç—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã (—Å—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ)
- –ù–∏–∑–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑–æ–≤

### **–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ú–æ–π–°–∫–ª–∞–¥
- ML –º–æ–¥–µ–ª–∏ (RandomForest)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ
- –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏! üöÄ 